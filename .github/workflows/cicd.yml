name: Node Application

on:
   push:
     branches:
       - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
       - name: Checkout Source
         uses: actions/checkout@v4
       - name: Login to Docker Hub
         run:  docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
       - name: Build Docker Image
         run: docker build -t pikai/node-server-money-tracker .
       - name: Push Docker Image
         run: docker push pikai/node-server-money-tracker:latest
  deploy:
    needs: build
    runs-on: self-hosted
    steps:
       - name: Pull Docker Image 
         run: docker pull pikai/node-server-money-tracker:latest
       - name: Run Container
         run: docker run -d -p 8080:8080 --name server_container -e MONGO_URL='${{ secrets.MONGO_URL }}' pikai/node-server-money-tracker
